<div id='info'>
    <span class="payment-errors"></span>
   <form action="" id="payment-form">
        <div class="form-row">
            <label>Card Number</label>
            <input type="text" size="20" autocomplete="off" class="card-number"
            {%if card%} value="{{card}}"{%endif%}
            />
        </div>
        <div class="form-row">
            <label>CVC</label>
            <input type="text" size="4" autocomplete="off" class="card-cvc"/>
        </div>
        <div class="form-row">
            <label>Expiration (MM/YYYY)</label>
            <input type="text" size="2" class="card-expiry-month"/>
            <span> / </span>
            <input type="text" size="4" class="card-expiry-year"/>
        </div>
        <button type="submit" class="submit-button">Submit Payment</button>
    </form>
</div>
<script type="text/javascript">
    $(function(){
        function stripeResponseHandler(status, response) {
            if (response.error) {
                $(".payment-errors").html(response.error.message);
            } else {
                var form$ = $("#payment-form");
                var token = response['id'];
                $.get('/s/'+token, function(data){
                    $("#info").empty();
                    $("#info").append(data);
                });
            }
            return false;
        }
        Stripe.setPublishableKey('{{key}}');
        $("#payment-form").submit(function(event) {
            // disable the submit button to prevent repeated clicks
            $('.submit-button').attr("disabled", "disabled");

            Stripe.createToken({
                number: $('.card-number').val(),
                cvc: $('.card-cvc').val(),
                exp_month: $('.card-expiry-month').val(),
                exp_year: $('.card-expiry-year').val()
            }, stripeResponseHandler);
            // prevent the form from submitting with the default action
            return false;
        });
    });
</script>
